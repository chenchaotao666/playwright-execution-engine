# Playwright å®Œæ•´APIåˆ—è¡¨ä¸å‰ç«¯å®ç°ä¼˜å…ˆçº§åˆ†æ

åŸºäºå®˜æ–¹æ–‡æ¡£çš„å…¨é¢åˆ†æï¼Œæˆ‘æ•´ç†äº†å®Œæ•´çš„Playwright APIå¹¶æŒ‰å®ç°ä¼˜å…ˆçº§è¿›è¡Œåˆ†ç±»ã€‚

## ğŸ¯ æœ€é«˜ä¼˜å…ˆçº§ (P0) - ç«‹å³å®ç°

è¿™äº›APIæ˜¯è‡ªåŠ¨åŒ–çš„æ ¸å¿ƒï¼Œå¿…é¡»æœ€å…ˆå®ç°ï¼š

### 1. é¡µé¢å¯¼èˆª
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.goto(url)` | `window.location.href = url` | â­ | é¡µé¢è·³è½¬ï¼Œæœ€åŸºç¡€åŠŸèƒ½ |
| `page.url()` | `window.location.href` | â­ | è·å–å½“å‰URL |
| `page.title()` | `document.title` | â­ | è·å–é¡µé¢æ ‡é¢˜ |

### 2. å…ƒç´ äº¤äº’ - ç‚¹å‡»
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.click(selector)` | `document.querySelector(selector).click()` | â­ | æœ€å¸¸ç”¨çš„äº¤äº’ |
| `locator.click()` | `element.click()` | â­ | ç°ä»£åŒ–å®šä½å™¨ç‚¹å‡» |

### 3. è¡¨å•å¡«å……
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.fill(selector, value)` | `element.value = value; element.dispatchEvent(new Event('input'))` | â­ | è¡¨å•è‡ªåŠ¨åŒ–æ ¸å¿ƒ |
| `locator.fill(value)` | åŒä¸Š | â­ | å®šä½å™¨å¡«å…… |

### 4. åŸºç¡€ç­‰å¾…
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.waitForTimeout(ms)` | `setTimeout(() => resolve(), ms)` | â­ | ç®€å•å»¶æ—¶ |
| `page.waitForSelector(selector)` | `MutationObserver + Promise` | â­â­â­ | ç­‰å¾…å…ƒç´ å‡ºç° |

## ğŸ”§ é«˜ä¼˜å…ˆçº§ (P1) - ç¬¬äºŒé˜¶æ®µå®ç°

### 5. å®šä½å™¨ç³»ç»Ÿ (ç°ä»£åŒ–æ ¸å¿ƒ)
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.locator(selector)` | è¿”å›Locatorå¯¹è±¡åŒ…è£…å™¨ | â­â­â­ | ç°ä»£åŒ–é€‰æ‹©å™¨ |
| `page.getByRole(role, options)` | `document.querySelector('[role="..."]')` | â­â­ | è¯­ä¹‰åŒ–å®šä½ |
| `page.getByText(text)` | `document.evaluate('//\*[contains(text(),"...")]')` | â­â­ | æ–‡æœ¬å®šä½ |
| `page.getByLabel(text)` | é€šè¿‡labelå…³è”æŸ¥æ‰¾input | â­â­ | è¡¨å•æ ‡ç­¾å®šä½ |
| `page.getByPlaceholder(text)` | `document.querySelector('[placeholder="..."]')` | â­ | å ä½ç¬¦å®šä½ |

### 6. è¡¨å•æ§ä»¶æ“ä½œ
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.check(selector)` | `element.checked = true; element.dispatchEvent(new Event('change'))` | â­ | é€‰æ‹©å¤é€‰æ¡† |
| `page.uncheck(selector)` | `element.checked = false; element.dispatchEvent(new Event('change'))` | â­ | å–æ¶ˆé€‰æ‹© |
| `page.selectOption(selector, value)` | `element.value = value; element.dispatchEvent(new Event('change'))` | â­â­ | ä¸‹æ‹‰é€‰æ‹© |

### 7. é”®ç›˜æ“ä½œ
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.press(selector, key)` | `element.dispatchEvent(new KeyboardEvent())` | â­â­ | æŒ‰é”®æ“ä½œ |
| `page.type(selector, text)` | é€å­—ç¬¦è¾“å…¥æ¨¡æ‹Ÿ | â­â­ | æ¨¡æ‹Ÿæ‰“å­— |
| `locator.pressSequentially(text)` | é”®ç›˜åºåˆ—æ“ä½œ | â­â­ | é¡ºåºæŒ‰é”® |

## ğŸ¨ ä¸­ç­‰ä¼˜å…ˆçº§ (P2) - ç¬¬ä¸‰é˜¶æ®µå®ç°

### 8. é¼ æ ‡æ“ä½œ
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.hover(selector)` | `element.dispatchEvent(new MouseEvent('mouseover'))` | â­â­ | é¼ æ ‡æ‚¬åœ |
| `page.dblclick(selector)` | `element.dispatchEvent(new MouseEvent('dblclick'))` | â­â­ | åŒå‡» |
| `locator.dragTo(target)` | æ‹–æ‹½äº‹ä»¶åºåˆ— | â­â­â­â­ | æ‹–æ‹½æ“ä½œ |

### 9. é¡µé¢ä¿¡æ¯è·å–
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.content()` | `document.documentElement.outerHTML` | â­ | é¡µé¢HTML |
| `locator.textContent()` | `element.textContent` | â­ | å…ƒç´ æ–‡æœ¬ |
| `locator.getAttribute(name)` | `element.getAttribute(name)` | â­ | å±æ€§å€¼ |
| `locator.isVisible()` | `element.offsetParent !== null` | â­â­ | å¯è§æ€§æ£€æŸ¥ |

### 10. é«˜çº§ç­‰å¾…
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.waitForURL(url)` | ç›‘å¬popstateäº‹ä»¶ | â­â­â­ | ç­‰å¾…URLå˜åŒ– |
| `page.waitForFunction(fn)` | `setIntervalæ£€æŸ¥æ¡ä»¶` | â­â­â­ | ç­‰å¾…æ¡ä»¶æ»¡è¶³ |
| `page.waitForLoadState(state)` | ç›‘å¬load/DOMContentLoaded | â­â­â­ | ç­‰å¾…åŠ è½½çŠ¶æ€ |
| `locator.waitFor(options)` | å…ƒç´ çŠ¶æ€ç­‰å¾… | â­â­â­ | ç­‰å¾…å…ƒç´ çŠ¶æ€ |

## ğŸ”¬ ä½ä¼˜å…ˆçº§ (P3) - é«˜çº§åŠŸèƒ½

### 11. è„šæœ¬æ‰§è¡Œ
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.evaluate(fn)` | `fn.call(window)` | â­â­ | é¡µé¢ä¸Šä¸‹æ–‡æ‰§è¡Œ |
| `page.addScriptTag(options)` | `document.head.appendChild(script)` | â­â­ | åŠ¨æ€æ·»åŠ è„šæœ¬ |
| `page.addStyleTag(options)` | `document.head.appendChild(style)` | â­â­ | åŠ¨æ€æ·»åŠ æ ·å¼ |

### 12. æˆªå›¾åŠŸèƒ½
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.screenshot(options)` | `html2canvas` ç¬¬ä¸‰æ–¹åº“ | â­â­â­â­â­ | éœ€è¦å¤–éƒ¨ä¾èµ– |
| `locator.screenshot(options)` | å…ƒç´ æˆªå›¾ | â­â­â­â­â­ | å…ƒç´ çº§æˆªå›¾ |

### 13. ç½‘ç»œå’Œå­˜å‚¨
| API | DOMå®ç° | å¤æ‚åº¦ | è¯´æ˜ |
|-----|---------|--------|------|
| `page.route(url, handler)` | Service Workeræ‹¦æˆª | â­â­â­â­â­ | ç½‘ç»œæ‹¦æˆª |
| `page.addInitScript(script)` | é¡µé¢åŠ è½½å‰æ³¨å…¥ | â­â­â­ | åˆå§‹åŒ–è„šæœ¬ |

## âŒ æ— æ³•å®ç° - æµè§ˆå™¨å®‰å…¨é™åˆ¶

è¿™äº›APIç”±äºæµè§ˆå™¨å®‰å…¨é™åˆ¶æ— æ³•åœ¨å‰ç«¯ç¯å¢ƒå®ç°ï¼š

| API | é™åˆ¶åŸå›  | æ›¿ä»£æ–¹æ¡ˆ |
|-----|----------|----------|
| `browser.newPage()` | å®‰å…¨é™åˆ¶ï¼Œæ— æ³•åˆ›å»ºæ–°æ ‡ç­¾é¡µ | åªèƒ½æ“ä½œå½“å‰é¡µé¢ |
| `page.setViewportSize()` | æ— æƒé™ä¿®æ”¹è§†å£ | ä½¿ç”¨CSS media queries |
| `browser.close()` | å®‰å…¨é™åˆ¶ | åªèƒ½å…³é—­å½“å‰æ ‡ç­¾ |
| `page.pdf()` | éœ€è¦æ‰“å°APIæƒé™ | ä½¿ç”¨window.print() |
| `page.video()` | å½•åˆ¶éœ€è¦ç‰¹æ®Šæƒé™ | æ— æ³•å®ç° |

## ğŸ“‹ å®ç°è·¯çº¿å›¾

### é˜¶æ®µ 1: MVP (2-3å‘¨)
```javascript
class PlaywrightDOM {
  async goto(url) { window.location.href = url; }
  async click(selector) { document.querySelector(selector)?.click(); }
  async fill(selector, value) { 
    const el = document.querySelector(selector);
    if (el) {
      el.value = value;
      el.dispatchEvent(new Event('input', { bubbles: true }));
    }
  }
  async waitForTimeout(ms) { 
    return new Promise(resolve => setTimeout(resolve, ms)); 
  }
}
```

### é˜¶æ®µ 2: æ ¸å¿ƒåŠŸèƒ½ (3-4å‘¨)
- å®ç°`waitForSelector`å’ŒLocatorç³»ç»Ÿ
- æ·»åŠ getByRoleã€getByTextç­‰ç°ä»£å®šä½å™¨
- å®ç°è¡¨å•æ§ä»¶æ“ä½œï¼ˆcheckã€selectOptionç­‰ï¼‰
- æ·»åŠ åŸºç¡€é”®ç›˜æ“ä½œ

### é˜¶æ®µ 3: é«˜çº§åŠŸèƒ½ (4-6å‘¨)
- å®ç°é«˜çº§ç­‰å¾…æœºåˆ¶
- æ·»åŠ é¼ æ ‡æ“ä½œå’Œæ‹–æ‹½
- å®ç°evaluateåŠŸèƒ½
- æ·»åŠ æˆªå›¾æ”¯æŒï¼ˆå¦‚æœéœ€è¦ï¼‰

## ğŸ”§ æ ¸å¿ƒæŠ€æœ¯å®ç°è¦ç‚¹

### 1. Locatorç³»ç»Ÿå®ç°
```javascript
class Locator {
  constructor(selector, page) {
    this.selector = selector;
    this.page = page;
  }
  
  async click() {
    const element = await this.waitForElement();
    element.click();
  }
  
  async fill(value) {
    const element = await this.waitForElement();
    element.value = value;
    element.dispatchEvent(new Event('input', { bubbles: true }));
  }
  
  async waitForElement() {
    return new Promise((resolve, reject) => {
      const element = document.querySelector(this.selector);
      if (element) return resolve(element);
      
      const observer = new MutationObserver(() => {
        const el = document.querySelector(this.selector);
        if (el) {
          observer.disconnect();
          resolve(el);
        }
      });
      
      observer.observe(document.body, { childList: true, subtree: true });
    });
  }
}
```

### 2. ç°ä»£å®šä½å™¨å®ç°
```javascript
class ModernLocators {
  getByRole(role, options = {}) {
    const { name } = options;
    let selector = `[role="${role}"]`;
    
    if (name) {
      // ç»“åˆaria-labelæˆ–æ–‡æœ¬å†…å®¹æŸ¥æ‰¾
      selector += `[aria-label*="${name}"], [role="${role}"]:contains("${name}")`;
    }
    
    return new Locator(selector, this);
  }
  
  getByText(text) {
    return new Locator(`*:contains("${text}")`, this);
  }
  
  getByLabel(label) {
    // é€šè¿‡labelæŸ¥æ‰¾å…³è”çš„input
    const selector = `label:contains("${label}") input, input[id]:has(+ label:contains("${label}"))`;
    return new Locator(selector, this);
  }
}
```

## ğŸ’¡ æ€»ç»“å»ºè®®

1. **ä¼˜å…ˆå®ç°P0çº§åˆ«API** - è¿™5-8ä¸ªAPIå°±èƒ½è¦†ç›–80%çš„è‡ªåŠ¨åŒ–åœºæ™¯
2. **é‡ç‚¹å…³æ³¨Locatorç³»ç»Ÿ** - è¿™æ˜¯Playwrightçš„æ ¸å¿ƒä¼˜åŠ¿ï¼Œåº”è¯¥é‡ç‚¹å®ç°
3. **é€æ­¥å®Œå–„ç­‰å¾…æœºåˆ¶** - è¿™æ˜¯ç¨³å®šæ€§çš„å…³é”®
4. **è€ƒè™‘é”™è¯¯å¤„ç†** - æ·»åŠ è¶…æ—¶ã€é‡è¯•æœºåˆ¶
5. **ä¿æŒAPIå…¼å®¹æ€§** - å°½é‡ä¸åŸç‰ˆPlaywrightä¿æŒæ¥å£ä¸€è‡´

è¿™ä¸ªåˆ†æåº”è¯¥èƒ½å¸®ä½ åˆ¶å®šæ¸…æ™°çš„å¼€å‘è®¡åˆ’ã€‚å»ºè®®ä»P0å¼€å§‹ï¼Œé€æ­¥å®ç°åˆ°P2çº§åˆ«å°±èƒ½æ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚äº†ã€‚