<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright æ‰§è¡Œå¼•æ“æ¼”ç¤º</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .demo-section {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .demo-section h3 {
            color: #495057;
            margin-top: 0;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 10px;
            resize: vertical;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        .output {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        
        .test-page {
            border: 2px solid #007bff;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: white;
        }
        
        .test-element {
            margin: 10px 0;
        }
        
        .test-element input, .test-element select, .test-element button {
            margin: 5px;
            padding: 8px;
        }
        
        .result-box {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            display: none;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ­ Playwright æ‰§è¡Œå¼•æ“æ¼”ç¤º</h1>
        <p>åœ¨æµè§ˆå™¨ä¸­ç›´æ¥è¿è¡Œ Playwright è„šæœ¬</p>
    </div>

    <!-- æµ‹è¯•é¡µé¢å…ƒç´  -->
    <div class="test-page">
        <h3>ğŸ¯ æµ‹è¯•é¡µé¢</h3>
        <p>è¿™äº›å…ƒç´ å¯ä»¥è¢« Playwright è„šæœ¬æ“ä½œï¼š</p>
        
        <div class="test-element">
            <label for="username">ç”¨æˆ·å:</label>
            <input type="text" id="username" placeholder="è¯·è¾“å…¥ç”¨æˆ·å" />
        </div>
        
        <div class="test-element">
            <label for="password">å¯†ç :</label>
            <input type="password" id="password" placeholder="è¯·è¾“å…¥å¯†ç " />
        </div>
        
        <div class="test-element">
            <label for="email">é‚®ç®±:</label>
            <input type="email" id="email" placeholder="example@email.com" />
        </div>
        
        <div class="test-element">
            <label for="country">å›½å®¶:</label>
            <select id="country">
                <option value="">é€‰æ‹©å›½å®¶</option>
                <option value="cn">ä¸­å›½</option>
                <option value="us">ç¾å›½</option>
                <option value="jp">æ—¥æœ¬</option>
            </select>
        </div>
        
        <div class="test-element">
            <label>
                <input type="checkbox" id="agree" />
                æˆ‘åŒæ„æœåŠ¡æ¡æ¬¾
            </label>
        </div>
        
        <div class="test-element">
            <button id="submit-btn" onclick="showResult()">æäº¤</button>
            <button id="reset-btn" onclick="resetForm()">é‡ç½®</button>
        </div>
        
        <div id="result" class="result-box">
            è¡¨å•æäº¤æˆåŠŸï¼
        </div>
    </div>

    <!-- ç¤ºä¾‹ 1: åŸºç¡€æ“ä½œ -->
    <div class="demo-section">
        <h3>ğŸ“ ç¤ºä¾‹ 1: åŸºç¡€è¡¨å•æ“ä½œ</h3>
        <textarea id="script1">import { test, expect } from '@playwright/test';

test('åŸºç¡€è¡¨å•å¡«å†™æµ‹è¯•', async ({ page }) => {
  // å¡«å†™è¡¨å•
  await page.fill('#username', 'testuser');
  await page.fill('#password', 'password123');
  await page.fill('#email', 'test@example.com');
  
  // é€‰æ‹©ä¸‹æ‹‰é€‰é¡¹
  await page.selectOption('#country', 'cn');
  
  // é€‰æ‹©å¤é€‰æ¡†
  await page.check('#agree');
  
  // ç‚¹å‡»æäº¤æŒ‰é’®
  await page.click('#submit-btn');
  
  // éªŒè¯ç»“æœ
  await expect(page.locator('#result')).toBeVisible();
  await expect(page.locator('#result')).toHaveText('è¡¨å•æäº¤æˆåŠŸï¼');
});</textarea>
        <button onclick="runScript('script1')">è¿è¡Œè„šæœ¬</button>
        <div id="output1" class="output"></div>
    </div>

    <!-- ç¤ºä¾‹ 2: ç°ä»£å®šä½å™¨ -->
    <div class="demo-section">
        <h3>ğŸ” ç¤ºä¾‹ 2: ç°ä»£å®šä½å™¨ä½¿ç”¨</h3>
        <textarea id="script2">import { test, expect } from '@playwright/test';

test('ç°ä»£å®šä½å™¨æµ‹è¯•', async ({ page }) => {
  // ä½¿ç”¨ getByLabel å®šä½å™¨
  await page.getByLabel('ç”¨æˆ·å').fill('modern_user');
  await page.getByLabel('å¯†ç ').fill('secure_pass');
  await page.getByLabel('é‚®ç®±').fill('modern@test.com');
  
  // ä½¿ç”¨ getByRole å®šä½å™¨
  await page.getByRole('combobox').selectOption('us');
  await page.getByRole('checkbox').check();
  
  // ä½¿ç”¨ getByText å®šä½å™¨
  await page.getByText('æäº¤').click();
  
  // éªŒè¯ç»“æœ
  const result = page.locator('#result');
  await expect(result).toBeVisible();
});</textarea>
        <button onclick="runScript('script2')">è¿è¡Œè„šæœ¬</button>
        <div id="output2" class="output"></div>
    </div>

    <!-- ç¤ºä¾‹ 3: ç­‰å¾…å’Œæ–­è¨€ -->
    <div class="demo-section">
        <h3>â±ï¸ ç¤ºä¾‹ 3: ç­‰å¾…æœºåˆ¶å’Œé«˜çº§æ–­è¨€</h3>
        <textarea id="script3">import { test, expect } from '@playwright/test';

test('ç­‰å¾…å’Œæ–­è¨€æµ‹è¯•', async ({ page }) => {
  // å¡«å†™è¡¨å•
  await page.fill('#username', 'wait_test_user');
  await page.fill('#email', 'wait@test.com');
  
  // æ£€æŸ¥å…ƒç´ çŠ¶æ€
  await expect(page.locator('#submit-btn')).toBeEnabled();
  await expect(page.locator('#result')).toBeHidden();
  
  // ç­‰å¾…å¹¶ç‚¹å‡»
  await page.click('#submit-btn');
  
  // ç­‰å¾…ç»“æœå‡ºç°
  await page.waitForSelector('#result:visible');
  
  // é«˜çº§æ–­è¨€
  await expect(page.locator('#result')).toBeVisible();
  await expect(page.locator('#result')).toHaveText(/æäº¤æˆåŠŸ/);
  
  // éªŒè¯è¡¨å•å€¼
  await expect(page.locator('#username')).toHaveValue('wait_test_user');
  await expect(page.locator('#email')).toHaveValue('wait@test.com');
});</textarea>
        <button onclick="runScript('script3')">è¿è¡Œè„šæœ¬</button>
        <div id="output3" class="output"></div>
    </div>

    <!-- ç¤ºä¾‹ 4: è‡ªå®šä¹‰è„šæœ¬ -->
    <div class="demo-section">
        <h3>âœï¸ ç¤ºä¾‹ 4: è‡ªå®šä¹‰è„šæœ¬</h3>
        <p>åœ¨ä¸‹é¢ç¼–å†™ä½ è‡ªå·±çš„ Playwright è„šæœ¬ï¼š</p>
        <textarea id="script4" placeholder="åœ¨è¿™é‡Œç¼–å†™ä½ çš„ Playwright è„šæœ¬...">import { test, expect } from '@playwright/test';

test('æˆ‘çš„è‡ªå®šä¹‰æµ‹è¯•', async ({ page }) => {
  // åœ¨è¿™é‡Œç¼–å†™ä½ çš„æµ‹è¯•ä»£ç 
  await page.fill('#username', 'è‡ªå®šä¹‰ç”¨æˆ·');
  await page.click('#submit-btn');
  
  await expect(page.locator('#result')).toBeVisible();
});</textarea>
        <button onclick="runScript('script4')">è¿è¡Œè‡ªå®šä¹‰è„šæœ¬</button>
        <div id="output4" class="output"></div>
    </div>

    <!-- åŠ è½½ Playwright æ‰§è¡Œå¼•æ“ -->
    <script src="../dist/playwright-execution-engine.js"></script>
    
    <script>
        // åˆå§‹åŒ–å¼•æ“
        const engine = new PlaywrightExecutionEngine({
            logLevel: 'info',
            timeout: 30000
        });

        // è¿è¡Œè„šæœ¬çš„é€šç”¨å‡½æ•°
        async function runScript(scriptId) {
            const scriptElement = document.getElementById(scriptId);
            const outputElement = document.getElementById(scriptId.replace('script', 'output'));
            const button = scriptElement.nextElementSibling;
            
            // ç¦ç”¨æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            button.disabled = true;
            button.innerHTML = '<span class="loading"></span> æ‰§è¡Œä¸­...';
            
            // æ¸…ç©ºè¾“å‡º
            outputElement.textContent = '';
            
            try {
                const script = scriptElement.value;
                console.log('æ‰§è¡Œè„šæœ¬:', script);
                
                // æ·»åŠ æ§åˆ¶å°è¾“å‡ºé‡å®šå‘
                const originalLog = console.log;
                const originalError = console.error;
                const originalWarn = console.warn;
                
                const logs = [];
                
                console.log = (...args) => {
                    logs.push('[LOG] ' + args.join(' '));
                    originalLog.apply(console, args);
                };
                
                console.error = (...args) => {
                    logs.push('[ERROR] ' + args.join(' '));
                    originalError.apply(console, args);
                };
                
                console.warn = (...args) => {
                    logs.push('[WARN] ' + args.join(' '));
                    originalWarn.apply(console, args);
                };
                
                // æ‰§è¡Œè„šæœ¬
                const result = await engine.runScript(script, scriptId);
                
                // æ¢å¤æ§åˆ¶å°
                console.log = originalLog;
                console.error = originalError;
                console.warn = originalWarn;
                
                // æ˜¾ç¤ºç»“æœ
                const output = [
                    `ğŸ“Š æ‰§è¡Œç»“æœ: ${result.success ? 'âœ… æˆåŠŸ' : 'âŒ å¤±è´¥'}`,
                    `â±ï¸ è€—æ—¶: ${result.duration}ms`,
                    `ğŸ§ª æµ‹è¯•æ•°é‡: ${result.results.length}`,
                    '',
                    'ğŸ“‹ è¯¦ç»†æ—¥å¿—:',
                    ...logs,
                    '',
                    'ğŸ” æµ‹è¯•è¯¦æƒ…:',
                    ...result.results.map(test => 
                        `  ${test.success ? 'âœ…' : 'âŒ'} ${test.name} (${test.duration}ms)${test.error ? '\n    é”™è¯¯: ' + test.error.message : ''}`
                    )
                ].join('\n');
                
                outputElement.textContent = output;
                
            } catch (error) {
                outputElement.textContent = `âŒ æ‰§è¡Œå¤±è´¥:\n${error.message}\n\nå †æ ˆä¿¡æ¯:\n${error.stack}`;
                console.error('è„šæœ¬æ‰§è¡Œå¤±è´¥:', error);
            } finally {
                // æ¢å¤æŒ‰é’®
                button.disabled = false;
                button.textContent = 'è¿è¡Œè„šæœ¬';
            }
        }

        // æµ‹è¯•é¡µé¢çš„è¾…åŠ©å‡½æ•°
        function showResult() {
            document.getElementById('result').style.display = 'block';
        }

        function resetForm() {
            document.getElementById('result').style.display = 'none';
            document.querySelectorAll('input, select').forEach(element => {
                if (element.type === 'checkbox') {
                    element.checked = false;
                } else {
                    element.value = '';
                }
            });
        }

        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ­ Playwright æ‰§è¡Œå¼•æ“æ¼”ç¤ºé¡µé¢åŠ è½½å®Œæˆ');
            console.log('å¼•æ“ç‰ˆæœ¬:', PlaywrightExecutionEngine.getVersion());
            
            // æ£€æŸ¥å…¼å®¹æ€§
            if (PlaywrightExecutionEngine.checkCompatibility()) {
                console.log('âœ… æµè§ˆå™¨å…¼å®¹æ€§æ£€æŸ¥é€šè¿‡');
            } else {
                console.warn('âš ï¸ æµè§ˆå™¨å…¼å®¹æ€§å­˜åœ¨é—®é¢˜');
            }
        });
    </script>
</body>
</html>