<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright æ‰§è¡Œå¼•æ“ - å¼€å‘è°ƒè¯•</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .status {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
            border-left: 4px solid;
        }
        
        .status.success {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        
        .demo-section {
            margin: 30px 0;
            padding: 25px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            background: #f8f9fa;
        }
        
        h2 {
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        
        textarea {
            width: 100%;
            height: 200px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }
        
        .result {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .api-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .api-card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .version-info {
            text-align: center;
            margin-top: 30px;
            padding: 20px;
            background: #e9ecef;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ­ Playwright æ‰§è¡Œå¼•æ“</h1>
        
        <div id="status" class="status">
            æ­£åœ¨åŠ è½½å¼•æ“...
        </div>
        
        <div class="demo-section">
            <h2>åŸºç¡€ API æµ‹è¯•</h2>
            <div class="api-info">
                <div class="api-card">
                    <h3>é¡µé¢æ“ä½œ</h3>
                    <button onclick="testPageAPI()">æµ‹è¯•é¡µé¢ API</button>
                    <div id="page-result" class="result"></div>
                </div>
                
                <div class="api-card">
                    <h3>å…ƒç´ å®šä½</h3>
                    <button onclick="testLocatorAPI()">æµ‹è¯•å®šä½å™¨ API</button>
                    <div id="locator-result" class="result"></div>
                </div>
                
                <div class="api-card">
                    <h3>ç­‰å¾…æœºåˆ¶</h3>
                    <button onclick="testWaitAPI()">æµ‹è¯•ç­‰å¾… API</button>
                    <div id="wait-result" class="result"></div>
                </div>
                
                <div class="api-card">
                    <h3>æœŸæœ›æ–­è¨€</h3>
                    <button onclick="testExpectAPI()">æµ‹è¯•æ–­è¨€ API</button>
                    <div id="expect-result" class="result"></div>
                </div>
            </div>
        </div>
        
        <div class="demo-section">
            <h2>è„šæœ¬æ‰§è¡Œæµ‹è¯•</h2>
            <textarea id="script-input" placeholder="åœ¨è¿™é‡Œè¾“å…¥ Playwright è„šæœ¬è¿›è¡Œæµ‹è¯•...">
// ç¤ºä¾‹è„šæœ¬
const page = engine.createPage();
await page.goto('https://example.com');
console.log('é¡µé¢æ ‡é¢˜:', await page.title());
            </textarea>
            <br>
            <button onclick="runCustomScript()">æ‰§è¡Œè„šæœ¬</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
            <div id="script-result" class="result"></div>
        </div>
        
        <div class="version-info">
            <h3>ç‰ˆæœ¬ä¿¡æ¯</h3>
            <div id="version-info">æ­£åœ¨è·å–ç‰ˆæœ¬ä¿¡æ¯...</div>
        </div>
    </div>

    <!-- å¼€å‘æ¨¡å¼ä¸‹ä½¿ç”¨ ES æ¨¡å— -->
    <script type="module">
        import PlaywrightExecutionEngine from './src/index.js';
        
        let engine = null;
        
        async function initEngine() {
            try {
                // æ£€æŸ¥å…¼å®¹æ€§
                if (!PlaywrightExecutionEngine.checkCompatibility()) {
                    throw new Error('æµè§ˆå™¨ä¸å…¼å®¹');
                }
                
                // åˆ›å»ºå¼•æ“å®ä¾‹
                engine = PlaywrightExecutionEngine.create({
                    logLevel: 'debug',
                    timeout: 10000
                });
                
                // æ›´æ–°çŠ¶æ€
                const statusEl = document.getElementById('status');
                statusEl.className = 'status success';
                statusEl.textContent = 'âœ… Playwright æ‰§è¡Œå¼•æ“åŠ è½½æˆåŠŸï¼';
                
                // æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
                const versionEl = document.getElementById('version-info');
                versionEl.innerHTML = `
                    <strong>ç‰ˆæœ¬:</strong> ${PlaywrightExecutionEngine.getVersion()}<br>
                    <strong>æ„å»ºæ—¶é—´:</strong> ${typeof __BUILD_TIME__ !== 'undefined' ? __BUILD_TIME__ : 'å¼€å‘æ¨¡å¼'}<br>
                    <strong>å…¼å®¹æ€§:</strong> âœ… æ‰€æœ‰åŠŸèƒ½å¯ç”¨
                `;
                
                console.log('ğŸ­ å¼•æ“åˆå§‹åŒ–å®Œæˆ');
                
            } catch (error) {
                console.error('å¼•æ“åˆå§‹åŒ–å¤±è´¥:', error);
                const statusEl = document.getElementById('status');
                statusEl.className = 'status error';
                statusEl.textContent = `âŒ å¼•æ“åŠ è½½å¤±è´¥: ${error.message}`;
            }
        }
        
        // å…¨å±€æµ‹è¯•å‡½æ•°
        window.testPageAPI = async function() {
            const resultEl = document.getElementById('page-result');
            try {
                const page = engine.createPage();
                const url = page.url();
                const title = page.title();
                
                resultEl.textContent = `å½“å‰é¡µé¢:\nURL: ${url}\næ ‡é¢˜: ${title}\n\nâœ… é¡µé¢ API æµ‹è¯•æˆåŠŸ`;
            } catch (error) {
                resultEl.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        };
        
        window.testLocatorAPI = async function() {
            const resultEl = document.getElementById('locator-result');
            try {
                const page = engine.createPage();
                const locator = page.locator('h1');
                const textContent = await locator.textContent();
                
                resultEl.textContent = `å®šä½å™¨æµ‹è¯•:\né€‰æ‹©å™¨: h1\næ–‡æœ¬å†…å®¹: ${textContent}\n\nâœ… å®šä½å™¨ API æµ‹è¯•æˆåŠŸ`;
            } catch (error) {
                resultEl.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        };
        
        window.testWaitAPI = async function() {
            const resultEl = document.getElementById('wait-result');
            try {
                const page = engine.createPage();
                const startTime = Date.now();
                await page.waitForTimeout(1000);
                const endTime = Date.now();
                
                resultEl.textContent = `ç­‰å¾…æµ‹è¯•:\nå¼€å§‹æ—¶é—´: ${new Date(startTime).toLocaleTimeString()}\nç»“æŸæ—¶é—´: ${new Date(endTime).toLocaleTimeString()}\nå®é™…è€—æ—¶: ${endTime - startTime}ms\n\nâœ… ç­‰å¾… API æµ‹è¯•æˆåŠŸ`;
            } catch (error) {
                resultEl.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        };
        
        window.testExpectAPI = async function() {
            const resultEl = document.getElementById('expect-result');
            try {
                const expect = engine.expect;
                const title = document.title;
                
                // æµ‹è¯•æ–­è¨€
                expect(title).toBeTruthy();
                expect(title).toContain('Playwright');
                
                resultEl.textContent = `æ–­è¨€æµ‹è¯•:\né¡µé¢æ ‡é¢˜: "${title}"\næ–­è¨€ 1: æ ‡é¢˜å­˜åœ¨ âœ…\næ–­è¨€ 2: æ ‡é¢˜åŒ…å« "Playwright" âœ…\n\nâœ… æ–­è¨€ API æµ‹è¯•æˆåŠŸ`;
            } catch (error) {
                resultEl.textContent = `âŒ æµ‹è¯•å¤±è´¥: ${error.message}`;
            }
        };
        
        window.runCustomScript = async function() {
            const scriptInput = document.getElementById('script-input');
            const resultEl = document.getElementById('script-result');
            
            try {
                const script = scriptInput.value;
                if (!script.trim()) {
                    throw new Error('è¯·è¾“å…¥è„šæœ¬å†…å®¹');
                }
                
                resultEl.textContent = 'æ­£åœ¨æ‰§è¡Œè„šæœ¬...\n';
                
                // æ‰§è¡Œè„šæœ¬
                const result = await engine.runScript(script, 'custom-script');
                
                resultEl.textContent += `\næ‰§è¡Œç»“æœ:\n${JSON.stringify(result, null, 2)}`;
                
            } catch (error) {
                resultEl.textContent = `âŒ è„šæœ¬æ‰§è¡Œå¤±è´¥: ${error.message}\n\n${error.stack || ''}`;
            }
        };
        
        window.clearResults = function() {
            document.querySelectorAll('.result').forEach(el => {
                el.textContent = '';
            });
        };
        
        // åˆå§‹åŒ–
        initEngine();
    </script>
</body>
</html>