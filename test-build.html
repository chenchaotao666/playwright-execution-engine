<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright 执行引擎 - 构建产物测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <h1>🎭 Playwright 执行引擎 - 构建产物测试</h1>
    
    <div id="status" class="test-section info">
        <h3>加载状态</h3>
        <p>正在加载构建产物...</p>
    </div>
    
    <div class="test-section">
        <h3>构建格式测试</h3>
        <button class="btn-primary" onclick="testUMD()">测试 UMD 格式</button>
        <button class="btn-primary" onclick="testIIFE()">测试 IIFE 格式</button>
        <button class="btn-success" onclick="testBasicAPI()">测试基础 API</button>
        <button class="btn-warning" onclick="clearResults()">清空结果</button>
    </div>
    
    <div id="results">
        <!-- 测试结果将显示在这里 -->
    </div>

    <!-- 加载 IIFE 格式的构建产物 -->
    <script src="./dist/playwright-execution-engine.iife.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `
                <h4>${new Date().toLocaleTimeString()}</h4>
                <pre>${message}</pre>
            `;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // 检查 IIFE 格式是否加载成功
        function checkIIFELoad() {
            try {
                if (typeof PlaywrightExecutionEngine !== 'undefined') {
                    const status = document.getElementById('status');
                    status.className = 'test-section success';
                    status.innerHTML = `
                        <h3>✅ 加载成功</h3>
                        <p>IIFE 格式构建产物已成功加载</p>
                        <p>全局对象: PlaywrightExecutionEngine</p>
                        <p>版本: ${PlaywrightExecutionEngine.getVersion()}</p>
                    `;
                    
                    log(`IIFE 格式加载成功
版本: ${PlaywrightExecutionEngine.getVersion()}
兼容性: ${PlaywrightExecutionEngine.checkCompatibility() ? '✅ 通过' : '❌ 失败'}
全局对象可用: ${typeof PlaywrightExecutionEngine !== 'undefined'}`, 'success');
                } else {
                    throw new Error('PlaywrightExecutionEngine 未定义');
                }
            } catch (error) {
                const status = document.getElementById('status');
                status.className = 'test-section error';
                status.innerHTML = `
                    <h3>❌ 加载失败</h3>
                    <p>错误: ${error.message}</p>
                `;
                log(`IIFE 格式加载失败: ${error.message}`, 'error');
            }
        }
        
        async function testUMD() {
            try {
                // 动态加载 UMD 格式
                const script = document.createElement('script');
                script.src = './dist/playwright-execution-engine.umd.js';
                script.onload = () => {
                    log(`UMD 格式测试成功
全局对象: ${typeof PlaywrightExecutionEngine !== 'undefined'}
版本: ${PlaywrightExecutionEngine.getVersion()}`, 'success');
                };
                script.onerror = () => {
                    log('UMD 格式加载失败', 'error');
                };
                document.head.appendChild(script);
            } catch (error) {
                log(`UMD 格式测试失败: ${error.message}`, 'error');
            }
        }
        
        function testIIFE() {
            try {
                if (typeof PlaywrightExecutionEngine === 'undefined') {
                    throw new Error('PlaywrightExecutionEngine 未加载');
                }
                
                const version = PlaywrightExecutionEngine.getVersion();
                const compatibility = PlaywrightExecutionEngine.checkCompatibility();
                
                log(`IIFE 格式测试结果:
✅ 全局对象存在: PlaywrightExecutionEngine
✅ 版本信息: ${version}
✅ 兼容性检查: ${compatibility ? '通过' : '失败'}
✅ 静态方法可用: create, run, load
✅ 组件导出: ${Object.keys(PlaywrightExecutionEngine.Components || {}).length} 个组件`, 'success');
                
            } catch (error) {
                log(`IIFE 格式测试失败: ${error.message}`, 'error');
            }
        }
        
        async function testBasicAPI() {
            try {
                if (typeof PlaywrightExecutionEngine === 'undefined') {
                    throw new Error('PlaywrightExecutionEngine 未加载');
                }
                
                // 创建引擎实例
                const engine = PlaywrightExecutionEngine.create({
                    logLevel: 'info'
                });
                
                // 测试页面 API
                const page = engine.createPage();
                const currentUrl = page.url();
                const currentTitle = page.title();
                
                // 测试等待 API
                const startTime = Date.now();
                await page.waitForTimeout(500);
                const duration = Date.now() - startTime;
                
                // 测试断言 API
                const expect = engine.expect;
                expect(currentTitle).toBeTruthy();
                
                log(`基础 API 测试成功:
📄 页面操作:
  - 获取 URL: ${currentUrl}
  - 获取标题: ${currentTitle}
  
⏱️ 等待机制:
  - waitForTimeout(500): ${duration}ms
  
✅ 断言系统:
  - expect(title).toBeTruthy(): 通过
  
🎯 引擎实例:
  - 创建成功: ✅
  - 配置加载: ✅
  - 方法可用: runScript, createPage, expect`, 'success');
                
            } catch (error) {
                log(`基础 API 测试失败: ${error.message}
堆栈: ${error.stack}`, 'error');
            }
        }
        
        // 页面加载完成后检查
        window.addEventListener('load', checkIIFELoad);
    </script>
</body>
</html>