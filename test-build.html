<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright æ‰§è¡Œå¼•æ“ - æ„å»ºäº§ç‰©æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
        }
        button {
            padding: 8px 16px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
    </style>
</head>
<body>
    <h1>ğŸ­ Playwright æ‰§è¡Œå¼•æ“ - æ„å»ºäº§ç‰©æµ‹è¯•</h1>
    
    <div id="status" class="test-section info">
        <h3>åŠ è½½çŠ¶æ€</h3>
        <p>æ­£åœ¨åŠ è½½æ„å»ºäº§ç‰©...</p>
    </div>
    
    <div class="test-section">
        <h3>æ„å»ºæ ¼å¼æµ‹è¯•</h3>
        <button class="btn-primary" onclick="testUMD()">æµ‹è¯• UMD æ ¼å¼</button>
        <button class="btn-primary" onclick="testIIFE()">æµ‹è¯• IIFE æ ¼å¼</button>
        <button class="btn-success" onclick="testBasicAPI()">æµ‹è¯•åŸºç¡€ API</button>
        <button class="btn-warning" onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
    </div>
    
    <div id="results">
        <!-- æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºåœ¨è¿™é‡Œ -->
    </div>

    <!-- åŠ è½½ IIFE æ ¼å¼çš„æ„å»ºäº§ç‰© -->
    <script src="./dist/playwright-execution-engine.iife.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-section ${type}`;
            div.innerHTML = `
                <h4>${new Date().toLocaleTimeString()}</h4>
                <pre>${message}</pre>
            `;
            results.appendChild(div);
        }
        
        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
        
        // æ£€æŸ¥ IIFE æ ¼å¼æ˜¯å¦åŠ è½½æˆåŠŸ
        function checkIIFELoad() {
            try {
                if (typeof PlaywrightExecutionEngine !== 'undefined') {
                    const status = document.getElementById('status');
                    status.className = 'test-section success';
                    status.innerHTML = `
                        <h3>âœ… åŠ è½½æˆåŠŸ</h3>
                        <p>IIFE æ ¼å¼æ„å»ºäº§ç‰©å·²æˆåŠŸåŠ è½½</p>
                        <p>å…¨å±€å¯¹è±¡: PlaywrightExecutionEngine</p>
                        <p>ç‰ˆæœ¬: ${PlaywrightExecutionEngine.getVersion()}</p>
                    `;
                    
                    log(`IIFE æ ¼å¼åŠ è½½æˆåŠŸ
ç‰ˆæœ¬: ${PlaywrightExecutionEngine.getVersion()}
å…¼å®¹æ€§: ${PlaywrightExecutionEngine.checkCompatibility() ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}
å…¨å±€å¯¹è±¡å¯ç”¨: ${typeof PlaywrightExecutionEngine !== 'undefined'}`, 'success');
                } else {
                    throw new Error('PlaywrightExecutionEngine æœªå®šä¹‰');
                }
            } catch (error) {
                const status = document.getElementById('status');
                status.className = 'test-section error';
                status.innerHTML = `
                    <h3>âŒ åŠ è½½å¤±è´¥</h3>
                    <p>é”™è¯¯: ${error.message}</p>
                `;
                log(`IIFE æ ¼å¼åŠ è½½å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testUMD() {
            try {
                // åŠ¨æ€åŠ è½½ UMD æ ¼å¼
                const script = document.createElement('script');
                script.src = './dist/playwright-execution-engine.umd.js';
                script.onload = () => {
                    log(`UMD æ ¼å¼æµ‹è¯•æˆåŠŸ
å…¨å±€å¯¹è±¡: ${typeof PlaywrightExecutionEngine !== 'undefined'}
ç‰ˆæœ¬: ${PlaywrightExecutionEngine.getVersion()}`, 'success');
                };
                script.onerror = () => {
                    log('UMD æ ¼å¼åŠ è½½å¤±è´¥', 'error');
                };
                document.head.appendChild(script);
            } catch (error) {
                log(`UMD æ ¼å¼æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function testIIFE() {
            try {
                if (typeof PlaywrightExecutionEngine === 'undefined') {
                    throw new Error('PlaywrightExecutionEngine æœªåŠ è½½');
                }
                
                const version = PlaywrightExecutionEngine.getVersion();
                const compatibility = PlaywrightExecutionEngine.checkCompatibility();
                
                log(`IIFE æ ¼å¼æµ‹è¯•ç»“æœ:
âœ… å…¨å±€å¯¹è±¡å­˜åœ¨: PlaywrightExecutionEngine
âœ… ç‰ˆæœ¬ä¿¡æ¯: ${version}
âœ… å…¼å®¹æ€§æ£€æŸ¥: ${compatibility ? 'é€šè¿‡' : 'å¤±è´¥'}
âœ… é™æ€æ–¹æ³•å¯ç”¨: create, run, load
âœ… ç»„ä»¶å¯¼å‡º: ${Object.keys(PlaywrightExecutionEngine.Components || {}).length} ä¸ªç»„ä»¶`, 'success');
                
            } catch (error) {
                log(`IIFE æ ¼å¼æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function testBasicAPI() {
            try {
                if (typeof PlaywrightExecutionEngine === 'undefined') {
                    throw new Error('PlaywrightExecutionEngine æœªåŠ è½½');
                }
                
                // åˆ›å»ºå¼•æ“å®ä¾‹
                const engine = PlaywrightExecutionEngine.create({
                    logLevel: 'info'
                });
                
                // æµ‹è¯•é¡µé¢ API
                const page = engine.createPage();
                const currentUrl = page.url();
                const currentTitle = page.title();
                
                // æµ‹è¯•ç­‰å¾… API
                const startTime = Date.now();
                await page.waitForTimeout(500);
                const duration = Date.now() - startTime;
                
                // æµ‹è¯•æ–­è¨€ API
                const expect = engine.expect;
                expect(currentTitle).toBeTruthy();
                
                log(`åŸºç¡€ API æµ‹è¯•æˆåŠŸ:
ğŸ“„ é¡µé¢æ“ä½œ:
  - è·å– URL: ${currentUrl}
  - è·å–æ ‡é¢˜: ${currentTitle}
  
â±ï¸ ç­‰å¾…æœºåˆ¶:
  - waitForTimeout(500): ${duration}ms
  
âœ… æ–­è¨€ç³»ç»Ÿ:
  - expect(title).toBeTruthy(): é€šè¿‡
  
ğŸ¯ å¼•æ“å®ä¾‹:
  - åˆ›å»ºæˆåŠŸ: âœ…
  - é…ç½®åŠ è½½: âœ…
  - æ–¹æ³•å¯ç”¨: runScript, createPage, expect`, 'success');
                
            } catch (error) {
                log(`åŸºç¡€ API æµ‹è¯•å¤±è´¥: ${error.message}
å †æ ˆ: ${error.stack}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ£€æŸ¥
        window.addEventListener('load', checkIIFELoad);
    </script>
</body>
</html>